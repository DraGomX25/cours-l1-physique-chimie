<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hub du Savoir avec Firebase</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Exo+2:wght@700&family=Poppins:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">

    <style>
        :root {
            --primary-color: #00e5ff;
            --secondary-color: #ff00c8;
            --maths-color: #ffdd00;
            --outils-color: #00ff8c;
            --background-color: #121220;
            --card-color: rgba(23, 23, 39, 0.85);
            --text-color: #f0f0f0;
            --success-color: #00ff8c;
            --error-color: #ff4d4d;
            --transition-duration: 0.6s;
        }

        /* --- STYLES GÉNÉRAUX --- */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        html { scroll-behavior: smooth; }
        body { font-family: 'Poppins', sans-serif; background-color: var(--background-color); color: var(--text-color); line-height: 1.6; overflow-x: hidden; }
        body.focus-mode .particle-container { opacity: 0 !important; }
        body.modal-open { overflow: hidden; }
        .particle-container { position: fixed; width: 100%; height: 100%; top: 0; left: 0; z-index: -1; opacity: 0; transition: opacity 0.8s ease-in-out; }
        .particle-container.active { opacity: 1; }
        .page-wrapper { position: relative; perspective: 1200px; }
        .page-view { width: 100%; display: none; backface-visibility: hidden; }
        .page-view.active { display: block; }
        .page-view.is-entering { animation: plungeIn var(--transition-duration) ease-out forwards; }
        .page-view.is-leaving { position: absolute; top: 0; left: 0; z-index: 10; animation: plungeOut var(--transition-duration) ease-in forwards; }
        @keyframes plungeIn { from { transform: translateZ(100px) scale(0.95); opacity: 0; } to { transform: translateZ(0) scale(1); opacity: 1; } }
        @keyframes plungeOut { from { transform: translateZ(0) scale(1); opacity: 1; } to { transform: translateZ(-100px) scale(0.95); opacity: 0; } }
        .header, .subject-header { padding: 7rem 1rem 5rem; text-align: center; position: relative; z-index: 1; }
        .header h1, .subject-header h1 { font-family: 'Exo 2', sans-serif; font-size: clamp(3rem, 10vw, 5.5rem); font-weight: 700; background: linear-gradient(90deg, var(--primary-color), var(--success-color), #b400ff, var(--primary-color)); background-size: 300% auto; -webkit-background-clip: text; background-clip: text; color: transparent; animation: colorCycle 8s linear infinite; }
        @keyframes colorCycle { to { background-position: -300%; } }
        .header p { font-size: clamp(1rem, 3vw, 1.2rem); opacity: 0.8; margin-top: 0.5rem; }
        .navbar { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 1.5rem; padding: 1rem; background: var(--card-color); backdrop-filter: blur(10px); position: sticky; top: 0; z-index: 100; border-bottom: 1px solid var(--primary-color); box-shadow: 0 4px 20px rgba(0, 229, 255, 0.2); }
        .nav-link { color: var(--text-color); text-decoration: none; font-size: 1.1rem; padding: 0.5rem 1rem; border-radius: 5px; transition: all 0.3s ease; cursor: pointer; display: flex; align-items: center; gap: 0.5rem; }
        .nav-link:hover, .nav-link:focus { background-color: var(--primary-color); color: var(--background-color); transform: translateY(-3px); box-shadow: 0 4px 15px rgba(0, 229, 255, 0.4); }
        .nav-item.hidden { display: none; }
        .main-content, .content-container { padding: 4rem 2rem; max-width: 1100px; margin: 0 auto; position: relative; z-index: 1; }
        .subject-card { background: var(--card-color); padding: 2.5rem; margin-bottom: 3rem; border-radius: 15px; border-left: 5px solid; transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); cursor: pointer; }
        #physique-card { border-color: var(--primary-color); }
        #chimie-card { border-color: var(--secondary-color); }
        #maths-card { border-color: var(--maths-color); }
        #physique-card:hover { transform: scale(1.08); box-shadow: 0 20px 45px rgba(0, 229, 255, 0.25); }
        #chimie-card:hover { transform: scale(1.08); box-shadow: 0 20px 45px rgba(255, 0, 200, 0.25); }
        #maths-card:hover { transform: scale(1.08); box-shadow: 0 20px 45px rgba(255, 221, 0, 0.25); }
        .subject-card h2, .subject-header h2, .resource-category h2 { font-size: 1.8rem; margin-bottom: 1.5rem; display: flex; align-items: center; gap: 1rem; }
        .subject-card i, .subject-header i, .resource-category i { font-size: 1.6rem; text-shadow: 0 0 8px currentColor; }
        .subject-header { padding: 5rem 2rem 3rem; }
        .resource-category { background: var(--card-color); border-radius: 15px; padding: 2rem; margin-bottom: 2.5rem; border-top: 3px solid; }
        .resource-category h2 { padding-bottom: 0.5rem; border-bottom: 1px solid rgba(255,255,255,0.2); }
        #page-physique .resource-category, #page-espace .resource-category, #page-simulation-pendule .resource-category { border-top-color: var(--primary-color); }
        #page-chimie .resource-category { border-top-color: var(--secondary-color); }
        #page-maths .resource-category { border-top-color: var(--maths-color); }
        #page-outils .resource-category { border-top-color: var(--outils-color); }
        #page-admin .resource-category { border-top-color: var(--success-color); }
        .resource-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 1.5rem; }
        .resource-item { background-color: rgba(255, 255, 255, 0.05); color: var(--text-color); text-decoration: none; padding: 1rem; border-radius: 8px; transition: all 0.3s ease; border-left: 3px solid transparent; display: flex; align-items: center; gap: 0.75rem; position: relative; }
        .resource-item:hover { background-color: rgba(0, 229, 255, 0.1); border-left-color: var(--primary-color); transform: translateY(-5px); color: var(--primary-color); }
        .auth-form-container, .auth-form { max-width: 500px; margin: 0 auto; }
        
        /* --- AMÉLIORATION DES FORMULAIRES D'AUTH ET ADMIN --- */
        .auth-form-container {
            background: var(--card-color);
            padding: 2.5rem 3rem;
            border-radius: 15px;
            border: 1px solid var(--primary-color);
            box-shadow: 0 0 30px rgba(0, 229, 255, 0.2);
            backdrop-filter: blur(5px);
        }

        .auth-form .form-group {
            margin-bottom: 1.8rem;
            position: relative;
        }

        .auth-form label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 700;
            color: var(--primary-color);
            text-transform: uppercase;
            font-size: 0.9rem;
            letter-spacing: 1px;
        }

        .auth-form input[type="email"],
        .auth-form input[type="password"],
        .auth-form input[type="text"],
        .auth-form input[type="url"],
        .auth-form input[type="file"],
        .auth-form select {
            width: 100%;
            padding: 0.8rem 1rem;
            background-color: rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: var(--text-color);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
        }

        .auth-form input:focus, .auth-form select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 15px rgba(0, 229, 255, 0.5);
        }
        
        .auth-form input[type="file"]::file-selector-button {
            background: var(--primary-color);
            border: none;
            padding: 0.6rem 1rem;
            border-radius: 5px;
            color: var(--background-color);
            font-weight: 700;
            cursor: pointer;
            transition: background-color 0.2s;
            margin-right: 1rem;
        }

        .auth-form input[type="file"]::file-selector-button:hover {
            background: #00b8d4;
        }
        
        .form-submit-btn {
            width: 100%;
            padding: 0.8rem 1rem;
            font-size: 1.1rem;
            font-weight: 700;
            font-family: 'Exo 2', sans-serif;
            color: var(--background-color);
            background: var(--primary-color);
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .form-submit-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 5px 20px rgba(0, 229, 255, 0.4);
        }
        
        .form-submit-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .form-switch-link {
            text-align: center;
            margin-top: 1.5rem;
            font-size: 0.9rem;
        }

        .form-switch-link a {
            color: var(--primary-color);
            font-weight: 700;
            text-decoration: none;
        }

        .form-switch-link a:hover {
            text-decoration: underline;
        }
        
        .auth-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            text-align: center;
            font-weight: 700;
            display: none;
        }
        .auth-message.success {
            background-color: rgba(0, 255, 140, 0.15);
            border: 1px solid var(--success-color);
            color: var(--success-color);
        }
        .auth-message.error {
            background-color: rgba(255, 77, 77, 0.15);
            border: 1px solid var(--error-color);
            color: var(--error-color);
        }

        /* --- STYLES DE GESTION ADMIN --- */
        .manage-courses-container {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin-top: 1.5rem;
        }

        .manage-course-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            background-color: rgba(255, 255, 255, 0.05);
            padding: 0.75rem 1.25rem;
            border-radius: 8px;
            border-left: 3px solid var(--secondary-color);
        }

        .manage-course-item .course-info {
            font-weight: 700;
        }

        .manage-course-item .course-info span {
            font-weight: 400;
            opacity: 0.7;
            font-size: 0.8rem;
            margin-left: 0.5rem;
        }

        .delete-course-btn {
            background: var(--error-color);
            color: var(--text-color);
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-weight: 700;
        }

        .delete-course-btn:hover {
            background: #ff2e2e;
            transform: scale(1.05);
        }
        .delete-course-btn:disabled {
            background-color: #555;
            cursor: not-allowed;
        }


        /* --- STYLES DES OUTILS --- */
        .tool-container { padding-top: 1rem; }
        .converter-form { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; align-items: center; }
        .converter-form input, .converter-form select { width: 100%; padding: 0.75rem; background: rgba(0, 0, 0, 0.25); border: 1px solid var(--outils-color); border-radius: 8px; color: var(--text-color); font-family: 'Poppins', sans-serif; font-size: 1rem; }
        .converter-result { margin-top: 1.5rem; text-align: center; font-size: 1.5rem; font-weight: 700; color: var(--outils-color); }
        .converter-result span { font-family: 'Exo 2', sans-serif; }

        .periodic-table-wrapper { display: flex; flex-direction: column; gap: 1.5rem; }
        .periodic-table { display: grid; grid-template-columns: repeat(18, 1fr); gap: 5px; max-width: 100%; overflow-x: auto; padding-bottom: 1rem;}
        .element-cell { background-color: rgba(255,255,255,0.05); border-radius: 5px; padding: 5px; text-align: center; cursor: pointer; transition: all 0.2s ease; border: 1px solid transparent; }
        .element-cell:hover { transform: scale(1.1); z-index: 10; border-color: var(--outils-color); }
        .element-cell .atomic-number { font-size: 0.7em; opacity: 0.8; }
        .element-cell .symbol { font-weight: 700; font-size: 1.2em; }
        .element-cell .name { font-size: 0.6em; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        .element-details { background-color: rgba(0,0,0,0.3); padding: 1.5rem; border-radius: 10px; border-left: 5px solid var(--outils-color); text-align: center; }
        .details-symbol { font-size: 4rem; font-weight: 700; }
        .details-name { font-size: 1.5rem; margin-bottom: 1rem; }
        .details-info { display: flex; justify-content: space-around; text-align: center; }
        .details-info-item { display: flex; flex-direction: column; }
        .details-info-item .value { font-weight: 700; font-size: 1.2rem; }
        .details-info-item .label { font-size: 0.8rem; opacity: 0.7; }
        .category-alkali-metal { background-color: #ff8a80; color: #212121; }
        .category-alkaline-earth-metal { background-color: #ffd180; color: #212121; }
        .category-lanthanide { background-color: #ffff8d; color: #212121; }
        .category-actinide { background-color: #cfd8dc; color: #212121; }
        .category-transition-metal { background-color: #80d8ff; color: #212121; }
        .category-post-transition-metal { background-color: #82b1ff; color: #212121; }
        .category-metalloid { background-color: #b9f6ca; color: #212121; }
        .category-diatomic-nonmetal, .category-polyatomic-nonmetal { background-color: #ccff90; color: #212121; }
        .category-noble-gas { background-color: #ea80fc; color: #212121; }

        /* --- STYLES SIMULATION --- */
        .simulation-wrapper { display: grid; grid-template-columns: 1fr; gap: 2rem; align-items: flex-start; }
        @media (min-width: 900px) { .simulation-wrapper { grid-template-columns: 3fr 2fr; } }
        #pendulum-canvas { background-color: rgba(0,0,0,0.2); border-radius: 10px; border: 1px solid var(--primary-color); cursor: pointer; width: 100%; height: auto; aspect-ratio: 600 / 400; }
        .simulation-controls { background: var(--card-color); padding: 2rem; border-radius: 15px; }
        .controls-grid { display: flex; flex-direction: column; gap: 1.5rem; }
        .control-item { display: flex; flex-direction: column; gap: 0.5rem; }
        .control-item label { font-weight: 700; display: flex; justify-content: space-between; }
        .control-item label span { color: var(--primary-color); font-family: 'Exo 2', sans-serif; }
        input[type="range"] { -webkit-appearance: none; appearance: none; width: 100%; height: 8px; background: rgba(255,255,255,0.2); border-radius: 5px; outline: none; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 20px; height: 20px; background: var(--primary-color); cursor: pointer; border-radius: 50%; border: 2px solid var(--background-color); box-shadow: 0 0 5px var(--primary-color); }
        .sim-actions { display: flex; justify-content: center; gap: 1rem; margin-top: 2rem; }
        .sim-button { background: var(--primary-color); color: var(--background-color); border: none; padding: 0.6rem 1.2rem; border-radius: 50px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; font-size: 1rem; }
        .sim-button:hover { transform: scale(1.1); box-shadow: 0 0 15px var(--primary-color); }
        .sim-button.secondary { background: transparent; color: var(--primary-color); border: 2px solid var(--primary-color); }

        /* --- STYLES FOOTER --- */
        .site-footer { padding: 2rem; text-align: center; background-color: rgba(18,18,32,0.6); margin-top: 4rem; border-top: 1px solid var(--primary-color); }
        .site-footer p { display: flex; justify-content: center; align-items: center; flex-wrap: wrap; gap: 0.5rem; }
        .social-link { display: inline-flex; align-items: center; gap: 0.5rem; color: var(--primary-color); text-decoration: none; font-weight: 700; transition: color 0.3s ease; }
        .social-link:hover { color: var(--text-color); }

    </style>
</head>
<body>
    
    <!-- Conteneurs de particules pour chaque page -->
    <div id="particles-accueil" class="particle-container active"></div>
    <div id="particles-physique" class="particle-container"></div>
    <div id="particles-chimie" class="particle-container"></div>
    <div id="particles-maths" class="particle-container"></div>
    <div id="particles-outils" class="particle-container"></div>
    <div id="particles-espace" class="particle-container"></div>
    <div id="particles-login" class="particle-container"></div>
    <div id="particles-signup" class="particle-container"></div>
    <div id="particles-simulation-pendule" class="particle-container"></div>
    <div id="particles-admin" class="particle-container"></div>


    <div class="page-wrapper">
        <nav class="navbar">
            <a class="nav-link" onclick="showPage('page-accueil')"><i class="fas fa-home"></i> Accueil</a>
            <a class="nav-link" onclick="showPage('page-physique')">Physique</a>
            <a class="nav-link" onclick="showPage('page-chimie')">Chimie</a>
            <a class="nav-link" onclick="showPage('page-maths')">Maths</a>
            <a class="nav-link" onclick="showPage('page-outils')"><i class="fas fa-wrench"></i> Outils</a>
            <a class="nav-link nav-item" id="auth-link" onclick="showPage('page-login')"><i class="fas fa-sign-in-alt"></i> Connexion</a>
            <a class="nav-link nav-item hidden" id="espace-link" onclick="showPage('page-espace')"><i class="fas fa-user-circle"></i> Mon Espace</a>
            <a class="nav-link nav-item hidden" id="admin-link" onclick="showPage('page-admin')"><i class="fas fa-user-shield"></i> Admin</a>
            <a class="nav-link nav-item" id="focus-mode-toggle"><i class="fas fa-eye"></i><span>Focus</span></a>
            <a class="nav-link nav-item hidden" id="logout-link"><i class="fas fa-sign-out-alt"></i> Déconnexion</a>
        </nav>

        <!-- Page Accueil -->
        <div id="page-accueil" class="page-view active">
            <header class="header" data-aos="fade-down"><h1>Hub du Savoir</h1><p>Votre portail vers la réussite en L1 Physique-Chimie</p></header>
            <main class="main-content">
                <section class="subject-card" data-aos="fade-right" id="physique-card" onclick="showPage('page-physique')">
                    <h2><i class="fas fa-atom"></i> Physique</h2><p>Explorez les lois fondamentales de l'univers, de la mécanique classique à l'électromagnétisme.</p>
                </section>
                <section class="subject-card" data-aos="fade-left" id="chimie-card" onclick="showPage('page-chimie')">
                    <h2><i class="fas fa-flask-vial"></i> Chimie</h2><p>Plongez dans le monde fascinant des atomes, des molécules et de leurs transformations.</p>
                </section>
                <section class="subject-card" data-aos="fade-right" id="maths-card" onclick="showPage('page-maths')">
                    <h2><i class="fas fa-calculator"></i> Maths</h2><p>Maîtrisez les outils mathématiques indispensables pour comprendre et modéliser les sciences.</p>
                </section>
            </main>
        </div>

        <!-- Page Physique -->
        <div id="page-physique" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-atom"></i>Physique</h1></header>
            <main class="content-container">
                <section class="resource-category" data-aos="fade-up"><h2><i class="fas fa-book-open"></i> Cours</h2>
                    <div class="resource-list" id="physique-cours-list">
                        <!-- Les cours de physique seront chargés ici par JavaScript -->
                    </div>
                </section>
                <section class="resource-category" data-aos="fade-up" data-aos-delay="150">
                    <h2><i class="fas fa-question-circle"></i> Quiz</h2>
                    <div class="resource-list">
                        <a class="resource-item quiz-trigger"><i class="fas fa-gamepad"></i>Lancer le Quiz : Mécanique (Bientôt disponible)</a>
                    </div>
                </section>
                <section class="resource-category" data-aos="fade-up" data-aos-delay="300">
                    <h2><i class="fas fa-project-diagram"></i> Simulations Interactives</h2>
                     <div class="resource-list">
                         <a onclick="showPage('page-simulation-pendule')" class="resource-item" style="cursor: pointer;">
                             <i class="fas fa-atom" style="transform: rotate(-45deg);"></i> Simulation : Pendule Simple
                         </a>
                     </div>
                </section>
            </main>
        </div>
        
        <!-- Page Simulation Pendule -->
        <div id="page-simulation-pendule" class="page-view">
             <header class="subject-header"><h1><i class="fas fa-atom" style="transform: rotate(-45deg);"></i>Pendule Simple</h1></header>
            <main class="content-container">
                <div class="simulation-wrapper">
                    <canvas id="pendulum-canvas"></canvas>
                    <div class="simulation-controls">
                        <h3>Paramètres</h3>
                        <div class="controls-grid">
                            <div class="control-item"><label for="length-slider">Longueur (L) <span id="length-value">200 m</span></label><input type="range" id="length-slider" min="50" max="300" value="200"></div>
                            <div class="control-item"><label for="mass-slider">Masse (m) <span id="mass-value">20 kg</span></label><input type="range" id="mass-slider" min="5" max="40" value="20"></div>
                            <div class="control-item"><label for="gravity-slider">Gravité (g) <span id="gravity-value">9.8 m/s²</span></label><input type="range" id="gravity-slider" min="1" max="300" value="98"></div>
                            <div class="control-item"><label for="angle-slider">Angle initial (θ) <span id="angle-value">45°</span></label><input type="range" id="angle-slider" min="-90" max="90" value="45"></div>
                        </div>
                    </div>
                </div>
                <div class="sim-actions"><button onclick="showPage('page-physique')" class="sim-button secondary"><i class="fas fa-arrow-left"></i> Retour à la Physique</button><button id="reset-pendulum-btn" class="sim-button">Réinitialiser</button></div>
            </main>
        </div>

        <!-- Page Chimie -->
        <div id="page-chimie" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-flask-vial"></i>Chimie</h1></header>
            <main class="content-container">
                <section class="resource-category" data-aos="fade-up"><h2><i class="fas fa-book-open"></i> Cours</h2>
                    <div class="resource-list" id="chimie-cours-list">
                        <!-- Les cours de chimie seront chargés ici par JavaScript -->
                    </div>
                </section>
            </main>
        </div>

        <!-- Page Maths -->
        <div id="page-maths" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-calculator"></i>Maths</h1></header>
            <main class="content-container">
                 <section class="resource-category" data-aos="fade-up"><h2><i class="fas fa-book-open"></i> Cours</h2>
                    <div class="resource-list" id="maths-cours-list">
                        <!-- Les cours de maths seront chargés ici par JavaScript -->
                    </div>
                </section>
            </main>
        </div>

        <!-- Page Outils -->
        <div id="page-outils" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-wrench"></i>Boîte à Outils</h1></header>
            <main class="content-container">
                <section class="resource-category" data-aos="fade-up">
                    <h2><i class="fas fa-exchange-alt"></i> Convertisseur d'Unités</h2>
                    <div class="tool-container">
                        <div class="converter-form">
                            <select id="converter-type"><option value="length">Longueur</option><option value="mass">Masse</option><option value="temperature">Température</option></select>
                            <input type="number" id="converter-input" value="1">
                            <select id="converter-from"></select>
                            <select id="converter-to"></select>
                        </div>
                        <p class="converter-result"><span id="converter-output"></span></p>
                    </div>
                </section>
                <section class="resource-category" data-aos="fade-up" data-aos-delay="150">
                    <h2><i class="fas fa-table"></i> Tableau Périodique Interactif</h2>
                    <div class="tool-container periodic-table-wrapper">
                       <div id="element-details-panel" class="element-details" style="display: none;"></div>
                       <div id="periodic-table-container" class="periodic-table"></div>
                    </div>
                </section>
            </main>
        </div>

        <!-- Pages Auth -->
        <div id="page-login" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-sign-in-alt"></i> Connexion</h1></header>
            <main class="content-container auth-form-container">
                <div id="login-message" class="auth-message"></div>
                <form id="login-form" class="auth-form" data-aos="fade-up">
                    <div class="form-group"><label for="login-email">Adresse e-mail</label><input type="email" id="login-email" required></div>
                    <div class="form-group"><label for="login-password">Mot de passe</label><input type="password" id="login-password" required></div>
                    <button type="submit" class="form-submit-btn">Se connecter</button>
                </form>
                <p class="form-switch-link">Pas encore de compte ? <a href="#" onclick="showPage('page-signup')">Inscrivez-vous</a></p>
            </main>
        </div>
        <div id="page-signup" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-user-plus"></i> Inscription</h1></header>
            <main class="content-container auth-form-container">
                <div id="signup-message" class="auth-message"></div>
                <form id="signup-form" class="auth-form" data-aos="fade-up">
                    <div class="form-group"><label for="signup-pseudo">Pseudonyme</label><input type="text" id="signup-pseudo" required></div>
                    <div class="form-group"><label for="signup-email">Adresse e-mail</label><input type="email" id="signup-email" required></div>
                    <div class="form-group"><label for="signup-password">Mot de passe</label><input type="password" id="signup-password" required minlength="6"></div>
                    <button type="submit" class="form-submit-btn">Créer mon compte</button>
                </form>
                <p class="form-switch-link">Déjà un compte ? <a href="#" onclick="showPage('page-login')">Connectez-vous</a></p>
            </main>
        </div>
        
        <!-- Page Espace Perso -->
        <div id="page-espace" class="page-view">
            <header class="subject-header"><h1 id="espace-title"><i class="fas fa-user-graduate"></i></h1></header>
            <main class="content-container">
                 <section class="resource-category" data-aos="fade-up"><h2><i class="fas fa-chart-line"></i> Mon Tableau de Bord</h2><div id="progress-dashboard" class="progress-dashboard"><div class="progress-subject"><h4>Physique</h4><div class="progress-bar-container"><div id="physique-progress-bar" class="progress-bar"></div></div><span id="physique-progress-percentage" class="progress-percentage">0%</span></div><div class="progress-subject"><h4>Chimie</h4><div class="progress-bar-container"><div id="chimie-progress-bar" class="progress-bar"></div></div><span id="chimie-progress-percentage" class="progress-percentage">0%</span></div><div class="progress-subject"><h4>Maths</h4><div class="progress-bar-container"><div id="maths-progress-bar" class="progress-bar"></div></div><span id="maths-progress-percentage" class="progress-percentage">0%</span></div></div></section>
                 <section class="resource-category" data-aos="fade-up" data-aos-delay="150"><h2><i class="fas fa-tasks"></i> Cours Terminés</h2><p id="progress-message">Cochez les cases des cours pour suivre votre progression.</p><ul id="detailed-progress-list"></ul></section>
            </main>
        </div>

        <!-- Page Admin -->
        <div id="page-admin" class="page-view">
            <header class="subject-header"><h1><i class="fas fa-user-shield"></i> Panel Administrateur</h1></header>
            <main class="content-container auth-form-container" style="max-width: 700px;">
                <section class="resource-category" data-aos="fade-up" style="border: none; background: none; padding: 0;">
                    <h2><i class="fas fa-plus-circle"></i> Ajouter un Cours</h2>
                    <form id="add-resource-form" class="auth-form">
                        <div class="form-group">
                            <label for="resource-subject">Matière</label>
                            <select id="resource-subject" required>
                                <option value="physique">Physique</option>
                                <option value="chimie">Chimie</option>
                                <option value="maths">Maths</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="resource-title">Titre du chapitre</label>
                            <input type="text" id="resource-title" required>
                        </div>
                        <div class="form-group">
                            <label for="resource-file">Fichier du cours (PDF)</label>
                            <input type="file" id="resource-file" accept=".pdf" required>
                        </div>
                        
                        <div id="upload-progress-container" style="display: none; margin-bottom: 1rem;">
                            <p>Chargement du fichier...</p>
                            <div style="background: #333; border-radius: 5px; overflow: hidden; margin-top: 0.5rem;">
                                <div id="upload-progress-bar" style="width: 0%; height: 10px; background: var(--primary-color); transition: width 0.3s ease;"></div>
                            </div>
                            <p id="upload-progress-text" style="text-align: center; margin-top: 0.5rem; font-family: 'Exo 2', sans-serif;"></p>
                        </div>

                        <button type="submit" class="form-submit-btn">Ajouter le cours</button>
                    </form>
                    <div id="admin-message" class="auth-message"></div>
                </section>

                <section class="resource-category" data-aos="fade-up" data-aos-delay="200" style="margin-top: 3rem; border-top-color: var(--error-color);">
                    <h2><i class="fas fa-trash-alt"></i> Gérer les Cours</h2>
                    <div id="manage-courses-list" class="manage-courses-container">
                        <p>Chargement des cours...</p>
                    </div>
                </section>

            </main>
        </div>

    </div>
    
    <footer class="site-footer">
        <p>
            <span>Une question ou une suggestion ? Retrouvez-moi sur Instagram :</span>
            <a href="https://www.instagram.com/Math.dlbe" target="_blank" rel="noopener noreferrer" class="social-link">
                <i class="fab fa-instagram"></i>
                <span>Math.dlbe</span>
            </a>
        </p>
    </footer>

    <script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
    <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>

    <script type="module">
        // --- IMPORTS FIREBASE ---
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, onAuthStateChanged, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, getDoc, updateDoc, onSnapshot, collection, addDoc, query, where, getDocs, orderBy, deleteDoc } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { getStorage, ref, uploadBytesResumable, getDownloadURL, deleteObject } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-storage.js";

        // --- ADMIN CONFIG ---
        // IMPORTANT: Ajoutez votre UID Firebase ici pour accéder au panel admin
        const adminUids = ["AmsVopQUooS79fgCuvq7lACxdQJ3"]; 

        // --- SCRIPT-WIDE STATE & CONFIG ---
        let isTransitioning = false;
        let unsubscribeFromFirestore = null;
        let animationFrameId = null;
        let simInitialized = false;
        let isDragging = false;
        let currentUserData = {};
        const pendulum = { length: 200, bobRadius: 20, angle: Math.PI / 4, angleVelocity: 0, angleAcceleration: 0, gravity: 0.1, damping: 0.998 };
        
        // --- CONFIGURATION FIREBASE ---
        const firebaseConfig = {
            apiKey: "FIREBASE_API_KEY",
            authDomain: "hub-du-savoir.firebaseapp.com",
            projectId: "hub-du-savoir",
            storageBucket: "hub-du-savoir.firebasestorage.app", // CORRECTION APPLIQUÉE ICI
            messagingSenderId: "679336582219",
            appId: "1:679336582219:web:20b548ad757c14e5abc1ce"
        };
        
        // --- DOM ELEMENT REFERENCES ---
        const authLink = document.getElementById('auth-link');
        const espaceLink = document.getElementById('espace-link');
        const logoutLink = document.getElementById('logout-link');
        const adminLink = document.getElementById('admin-link');
        const loginForm = document.getElementById('login-form');
        const signupForm = document.getElementById('signup-form');
        const addResourceForm = document.getElementById('add-resource-form');
        const focusToggle = document.getElementById('focus-mode-toggle');
        
        let canvas, ctx, resetButton, lengthSlider, massSlider, gravitySlider, angleSlider;
        let lengthValue, massValue, gravityValue, angleValue;
        let pivotX, pivotY;
        let converterType, converterInput, converterFrom, converterTo, converterOutput;
        let periodicTableContainer, elementDetailsPanel;
        let elementsData = [];

        // --- INITIALIZATION ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const storage = getStorage(app);
        
        AOS.init({ duration: 900, once: true, offset: 50 });
        
        const particleConfigs = {
            "accueil": { "particles": { "number": { "value": 80 }, "color": { "value": "#00e5ff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.5, "random": true }, "size": { "value": 3, "random": true }, "line_linked": { "enable": true, "distance": 150, "color": "#00e5ff", "opacity": 0.4 }, "move": { "enable": true, "speed": 6, "direction": "none", "out_mode": "out" } }, "interactivity": { "events": { "onhover": { "enable": true, "mode": "repulse" } } } },
            "physique": { "particles": { "number": { "value": 50 }, "color": { "value": "#00e5ff" }, "shape": { "type": "triangle" }, "opacity": { "value": 0.6 }, "size": { "value": 4 }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 4, "direction": "bottom", "out_mode": "out" } } },
            "chimie": { "particles": { "number": { "value": 100 }, "color": { "value": "#ff00c8" }, "shape": { "type": "circle" }, "opacity": { "value": 0.8, "random": true }, "size": { "value": 2, "random": true }, "line_linked": { "enable": false }, "move": { "enable": true, "speed": 2, "direction": "top-right", "out_mode": "out" } } },
            "maths": { "particles": { "number": { "value": 60 }, "color": { "value": "#ffdd00" }, "shape": { "type": "edge" }, "opacity": { "value": 0.7 }, "size": { "value": 5, "random": true }, "line_linked": { "enable": true, "color": "#ffdd00" }, "move": { "enable": true, "speed": 3, "direction": "none", "out_mode": "bounce" } } },
            "outils": { "particles": { "number": { "value": 70 }, "color": { "value": "#00ff8c" }, "shape": { "type": "star" }, "opacity": { "value": 0.5 }, "size": { "value": 3 }, "move": { "enable": true, "speed": 2 } } },
            "espace": { "particles": { "number": { "value": 150 }, "color": { "value": ["#00e5ff", "#ff00c8", "#00ff8c"] }, "shape": { "type": "star" }, "opacity": { "value": 0.7 }, "size": { "value": 2 }, "move": { "enable": true, "speed": 1 } } },
            "login": { "particles": { "number": { "value": 30 }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.3 }, "size": { "value": 1 }, "line_linked": { "enable": true, "color": "#ffffff" }, "move": { "enable": true, "speed": 1 } } },
            "signup": { "particles": { "number": { "value": 30 }, "color": { "value": "#ffffff" }, "shape": { "type": "circle" }, "opacity": { "value": 0.3 }, "size": { "value": 1 }, "line_linked": { "enable": true, "color": "#ffffff" }, "move": { "enable": true, "speed": 1 } } },
            "simulation-pendule": { "particles": { "number": { "value": 20 }, "color": { "value": "#f0f0f0" }, "shape": { "type": "circle" }, "opacity": { "value": 0.2 }, "size": { "value": 2 }, "move": { "enable": true, "speed": 1, "direction": "none", "out_mode": "out" } } },
            "admin": { "particles": { "number": { "value": 30 }, "color": { "value": "#00ff8c" }, "shape": { "type": "star" }, "opacity": { "value": 0.4 }, "size": { "value": 4 }, "move": { "enable": true, "speed": 1 } } }
        };
        Object.keys(particleConfigs).forEach(key => { if (document.getElementById(`particles-${key}`)) { particlesJS(`particles-${key}`, particleConfigs[key]); } });

        // --- FUNCTION DEFINITIONS ---
        window.showPage = async function(pageId) {
            if (isTransitioning) return;

            const isUserAdmin = auth.currentUser && adminUids.includes(auth.currentUser.uid);
            if (pageId === 'page-admin' && !isUserAdmin) {
                showPage('page-accueil');
                return;
            }
            if (pageId === 'page-espace' && !auth.currentUser) {
                showPage('page-login');
                return;
            }
            if (animationFrameId && pageId !== 'page-simulation-pendule') {
                cancelAnimationFrame(animationFrameId);
                animationFrameId = null;
                simInitialized = false; 
            }

            const targetPage = document.getElementById(pageId);
            const currentPage = document.querySelector('.page-view.active');
            if (!targetPage || (currentPage && targetPage.isSameNode(currentPage))) return;
            
            isTransitioning = true;
            window.scrollTo(0, 0);
            
            const particleId = pageId.replace('page-', '');
            document.querySelectorAll('.particle-container').forEach(p => p.classList.remove('active'));
            const particleEl = document.querySelector(`#particles-${particleId}`);
            if (particleEl) particleEl.classList.add('active');
            
            if (currentPage) {
                currentPage.classList.add('is-leaving');
                currentPage.addEventListener('animationend', () => currentPage.classList.remove('active', 'is-leaving'), { once: true });
            }

            targetPage.classList.add('active', 'is-entering');

            const subjectMap = {
                'page-physique': { subject: 'physique', container: 'physique-cours-list' },
                'page-chimie':   { subject: 'chimie',   container: 'chimie-cours-list' },
                'page-maths':    { subject: 'maths',    container: 'maths-cours-list' }
            };

            if (subjectMap[pageId]) {
                const { subject, container } = subjectMap[pageId];
                if (auth.currentUser) {
                    await loadResources(subject, container);
                } else {
                    const listContainer = document.getElementById(container);
                    if (listContainer) {
                        listContainer.innerHTML = `<p style="opacity: 0.7;">Veuillez vous connecter pour voir les cours.</p>`;
                    }
                }
            }

            targetPage.addEventListener('animationend', () => {
                targetPage.classList.remove('is-entering');
                isTransitioning = false;
                AOS.refresh();
                if (pageId === 'page-simulation-pendule') initPendulum();
                if (pageId === 'page-outils') initTools();
                if (pageId === 'page-admin') loadCoursesForAdmin();
            }, { once: true });
        }
        
        function updateUIForUser(user, userData) {
            currentUserData = userData;
            authLink.classList.add('hidden');
            espaceLink.classList.remove('hidden');
            logoutLink.classList.remove('hidden');
            adminLink.classList.toggle('hidden', !adminUids.includes(user.uid));
            
            const espaceTitle = document.getElementById('espace-title');
            if (espaceTitle) {
                espaceTitle.innerHTML = `<i class="fas fa-user-graduate"></i> Espace de ${userData.pseudo || 'l\'Utilisateur'}`;
            }

            espaceLink.innerHTML = `<i class="fas fa-user-circle"></i> ${userData.pseudo || 'Mon Espace'}`;
            updateProgressDashboard(userData.progress || {});
            updateCheckboxes(userData.progress || {});
        }

        function updateUIForGuest() {
            currentUserData = {};
            authLink.classList.remove('hidden');
            espaceLink.classList.add('hidden');
            logoutLink.classList.add('hidden');
            adminLink.classList.add('hidden');

            ['physique-cours-list', 'chimie-cours-list', 'maths-cours-list'].forEach(id => {
                const container = document.getElementById(id);
                if(container) container.innerHTML = `<p style="opacity: 0.7;">Veuillez vous connecter pour voir les cours.</p>`;
            });
            
            updateProgressDashboard({});
            updateCheckboxes({});
            const currentPage = document.querySelector('.page-view.active');
            if (currentPage && (currentPage.id === 'page-espace' || currentPage.id === 'page-admin')) {
                showPage('page-accueil');
            }
        }
        
        function showMessage(formId, text, type) {
            const el = document.getElementById(`${formId}-message`);
            if (el) {
                el.textContent = text;
                el.className = `auth-message ${type}`;
                el.style.display = 'block';
                setTimeout(() => { el.style.display = 'none'; }, 6000);
            }
        }

        async function updateProgressDashboard(progress = {}) {
            const subjects = ['physique', 'chimie', 'maths'];
            
            if (!auth.currentUser) {
                subjects.forEach(subject => {
                    const bar = document.getElementById(`${subject}-progress-bar`);
                    const percDisplay = document.getElementById(`${subject}-progress-percentage`);
                    if(bar) bar.style.width = `0%`;
                    if(percDisplay) percDisplay.textContent = `0%`;
                });
                return;
            }
            
            for (const subject of subjects) {
                try {
                    const q = query(collection(db, "resources"), where("subject", "==", subject));
                    const querySnapshot = await getDocs(q);
                    const total = querySnapshot.size;
                    
                    if (total === 0) {
                        const bar = document.getElementById(`${subject}-progress-bar`);
                        const percDisplay = document.getElementById(`${subject}-progress-percentage`);
                        if(bar) bar.style.width = '0%';
                        if(percDisplay) percDisplay.textContent = '0%';
                        continue;
                    }

                    const completedIds = Object.keys(progress).filter(key => progress[key]);
                    const completed = completedIds.filter(id => querySnapshot.docs.some(doc => doc.id === id && doc.data().subject === subject)).length;

                    const percentage = Math.round((completed / total) * 100);
                    
                    const bar = document.getElementById(`${subject}-progress-bar`);
                    const percDisplay = document.getElementById(`${subject}-progress-percentage`);
                    if(bar) bar.style.width = `${percentage}%`;
                    if(percDisplay) percDisplay.textContent = `${percentage}%`;
                } catch (error) {
                    console.error(`Error calculating progress for ${subject}:`, error);
                }
            }
        }


        function updateCheckboxes(progress = {}) {
            document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                checkbox.checked = progress[checkbox.dataset.id] || false;
            });
        }
        
        async function loadResources(subject, containerId) {
            const container = document.getElementById(containerId);
            if (!container) return;

            if (!auth.currentUser) {
                container.innerHTML = `<p style="opacity: 0.7;">Veuillez vous connecter pour voir les cours.</p>`;
                return;
            }

            try {
                const q = query(collection(db, "resources"), where("subject", "==", subject), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);
                
                if (querySnapshot.empty) {
                    container.innerHTML = `<p style="opacity: 0.7;">Aucun cours disponible pour le moment.</p>`;
                    return;
                }

                let resourcesHtml = '';
                querySnapshot.forEach((doc) => {
                    const resource = doc.data();
                    resourcesHtml += `
                        <div class="resource-item">
                            <input type="checkbox" class="progress-checkbox" data-subject="${subject}" data-id="${doc.id}" style="margin-right: 10px; transform: scale(1.2); cursor: pointer;">
                            <a href="${resource.url}" target="_blank" rel="noopener noreferrer" style="color: inherit; text-decoration: none; display: flex; align-items: center; gap: 0.5rem; flex-grow: 1;">
                               <i class="fas fa-file-pdf"></i> ${resource.title}
                            </a>
                        </div>`;
                });

                container.innerHTML = resourcesHtml;
                updateCheckboxes(currentUserData.progress || {});
                attachCheckboxListeners();
            } catch (error) {
                console.error("Error loading resources: ", error);
                container.innerHTML = `<p style="opacity: 0.7; color: var(--error-color);">Erreur de chargement des cours. Avez-vous créé l'index composé dans Firestore ?</p>`;
            }
        }

        function attachCheckboxListeners() {
             document.querySelectorAll('.progress-checkbox').forEach(checkbox => {
                const newCheckbox = checkbox.cloneNode(true);
                checkbox.parentNode.replaceChild(newCheckbox, checkbox);

                newCheckbox.addEventListener('change', (e) => {
                    const user = auth.currentUser;
                    if (!user) {
                        e.target.checked = false;
                        showPage('page-login');
                        return;
                    }
                    const resourceId = e.target.dataset.id;
                    const isChecked = e.target.checked;
                    const userDocRef = doc(db, "users", user.uid);
                    updateDoc(userDocRef, { [`progress.${resourceId}`]: isChecked });
                });
            });
        }

        async function loadCoursesForAdmin() {
            const container = document.getElementById('manage-courses-list');
            if (!container) return;
            container.innerHTML = '<p>Chargement des cours...</p>';

            try {
                const q = query(collection(db, "resources"), orderBy("createdAt", "desc"));
                const querySnapshot = await getDocs(q);

                if (querySnapshot.empty) {
                    container.innerHTML = '<p>Aucun cours à gérer pour le moment.</p>';
                    return;
                }

                let coursesHtml = '';
                querySnapshot.forEach(doc => {
                    const course = doc.data();
                    coursesHtml += `
                        <div class="manage-course-item" id="manage-item-${doc.id}">
                            <div class="course-info">
                                ${course.title}
                                <span>(${course.subject})</span>
                            </div>
                            <button class="delete-course-btn" data-doc-id="${doc.id}" data-file-url="${course.url}">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    `;
                });
                container.innerHTML = coursesHtml;

                document.querySelectorAll('.delete-course-btn').forEach(button => {
                    button.addEventListener('click', handleDeleteCourse);
                });

            } catch (error) {
                console.error("Error loading courses for admin:", error);
                container.innerHTML = '<p style="color: var(--error-color);">Erreur lors du chargement des cours.</p>';
            }
        }

        async function handleDeleteCourse(event) {
            const button = event.currentTarget;
            const docId = button.dataset.docId;
            const fileUrl = button.dataset.fileUrl;
            
            // Une confirmation est fortement recommandée en production
            // if (!confirm("Êtes-vous sûr de vouloir supprimer ce cours ? Cette action est irréversible.")) {
            //     return;
            // }

            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

            try {
                if (fileUrl) {
                    const storageRef = ref(storage, fileUrl);
                    await deleteObject(storageRef);
                }

                await deleteDoc(doc(db, "resources", docId));

                const itemToRemove = document.getElementById(`manage-item-${docId}`);
                if (itemToRemove) {
                    itemToRemove.style.transition = 'opacity 0.5s ease';
                    itemToRemove.style.opacity = '0';
                    setTimeout(() => itemToRemove.remove(), 500);
                }
                
                showMessage('admin', 'Cours supprimé avec succès!', 'success');

            } catch (error) {
                console.error("Error deleting course: ", error);
                showMessage('admin', `Erreur lors de la suppression: ${error.message}`, 'error');
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-trash"></i>';
            }
        }


        // --- SIMULATION FUNCTIONS ---
        function setCanvasDimensions() { if (!canvas) return; const containerWidth = canvas.parentElement.clientWidth; canvas.width = containerWidth; canvas.height = containerWidth * (400 / 600); pivotX = canvas.width / 2; pivotY = canvas.height * 0.15; }
        function updatePendulumParameters() { if (!simInitialized) return; pendulum.length = +lengthSlider.value; pendulum.bobRadius = +massSlider.value; pendulum.gravity = +gravitySlider.value / 1000; lengthValue.textContent = `${lengthSlider.value} m`; massValue.textContent = `${massSlider.value} kg`; gravityValue.textContent = `${(gravitySlider.value / 10).toFixed(1)} m/s²`; const newAngle = +angleSlider.value * (Math.PI / 180); angleValue.textContent = `${angleSlider.value}°`; if(!isDragging && pendulum.angle.toFixed(4) !== newAngle.toFixed(4)) { pendulum.angle = newAngle; pendulum.angleVelocity = 0; } }
        function updatePendulumPhysics() { if (isDragging) return; pendulum.angleAcceleration = (-pendulum.gravity / pendulum.length) * Math.sin(pendulum.angle); pendulum.angleVelocity += pendulum.angleAcceleration; pendulum.angleVelocity *= pendulum.damping; pendulum.angle += pendulum.angleVelocity; }
        function drawPendulum() { if (!ctx) return; ctx.clearRect(0, 0, canvas.width, canvas.height); const bobX = pivotX + pendulum.length * Math.sin(pendulum.angle); const bobY = pivotY + pendulum.length * Math.cos(pendulum.angle); ctx.fillStyle = '#f0f0f0'; ctx.fillRect(pivotX - 30, pivotY - 10, 60, 20); ctx.beginPath(); ctx.moveTo(pivotX, pivotY); ctx.lineTo(bobX, bobY); ctx.strokeStyle = '#f0f0f0'; ctx.lineWidth = 2; ctx.stroke(); ctx.beginPath(); ctx.arc(bobX, bobY, pendulum.bobRadius, 0, Math.PI * 2); ctx.fillStyle = isDragging ? 'var(--secondary-color)' : 'var(--primary-color)'; ctx.fill(); }
        function animatePendulum() { updatePendulumPhysics(); drawPendulum(); animationFrameId = requestAnimationFrame(animatePendulum); }
        function getMousePos(canvas, evt) { const rect = canvas.getBoundingClientRect(); return { x: evt.clientX - rect.left, y: evt.clientY - rect.top }; }
        function handleMouseDown(e) { if (!simInitialized) return; const mousePos = getMousePos(canvas, e); const bobX = pivotX + pendulum.length * Math.sin(pendulum.angle); const bobY = pivotY + pendulum.length * Math.cos(pendulum.angle); const dist = Math.sqrt(Math.pow(mousePos.x - bobX, 2) + Math.pow(mousePos.y - bobY, 2)); if (dist < pendulum.bobRadius) isDragging = true; }
        function handleMouseUp() { isDragging = false; }
        function handleMouseMove(e) { if (!isDragging) return; const mousePos = getMousePos(canvas, e); const dx = mousePos.x - pivotX; const dy = mousePos.y - pivotY; pendulum.angle = Math.atan2(dx, dy); const degrees = Math.round(pendulum.angle * (180 / Math.PI)); angleSlider.value = degrees; angleValue.textContent = `${degrees}°`; pendulum.angleVelocity = 0; }
        function resetPendulum() { if (!simInitialized) return; lengthSlider.value = 200; massSlider.value = 20; gravitySlider.value = 98; angleSlider.value = 45; updatePendulumParameters(); }
        function initPendulum() { if (simInitialized) return; canvas = document.getElementById('pendulum-canvas'); if (!canvas) return; ctx = canvas.getContext('2d'); resetButton = document.getElementById('reset-pendulum-btn'); lengthSlider = document.getElementById('length-slider'); massSlider = document.getElementById('mass-slider'); gravitySlider = document.getElementById('gravity-slider'); angleSlider = document.getElementById('angle-slider'); lengthValue = document.getElementById('length-value'); massValue = document.getElementById('mass-value'); gravityValue = document.getElementById('gravity-value'); angleValue = document.getElementById('angle-value'); if (animationFrameId) cancelAnimationFrame(animationFrameId); setCanvasDimensions(); updatePendulumParameters(); animatePendulum(); [lengthSlider, massSlider, gravitySlider, angleSlider].forEach(slider => { slider.addEventListener('input', updatePendulumParameters); }); canvas.addEventListener('mousedown', handleMouseDown); canvas.addEventListener('mouseup', handleMouseUp); canvas.addEventListener('mouseleave', handleMouseUp); canvas.addEventListener('mousemove', handleMouseMove); resetButton.addEventListener('click', resetPendulum); window.addEventListener('resize', setCanvasDimensions); simInitialized = true; }

        // --- TOOLS FUNCTIONS ---
        const units = { length: { 'km': { toBase: v => v * 1000, fromBase: v => v / 1000 }, 'm':  { toBase: v => v, fromBase: v => v }, 'cm': { toBase: v => v * 0.01, fromBase: v => v / 0.01 }, 'mm': { toBase: v => v * 1e-3, fromBase: v => v / 1e-3 }, 'µm': { toBase: v => v * 1e-6, fromBase: v => v / 1e-6 }, 'nm': { toBase: v => v * 1e-9, fromBase: v => v / 1e-9 }, 'pm': { toBase: v => v * 1e-12, fromBase: v => v / 1e-12 } }, mass: { 't':  { toBase: v => v * 1e6, fromBase: v => v / 1e6 }, 'kg': { toBase: v => v * 1000, fromBase: v => v / 1000 }, 'g':  { toBase: v => v, fromBase: v => v }, 'mg': { toBase: v => v * 1e-3, fromBase: v => v / 1e-3 }, 'µg': { toBase: v => v * 1e-6, fromBase: v => v / 1e-6 } }, temperature: { 'celsius': { toBase: c => c + 273.15, fromBase: k => k - 273.15 }, 'kelvin': { toBase: k => k, fromBase: k => k }, 'fahrenheit': { toBase: f => (f - 32) * 5/9 + 273.15, fromBase: k => (k - 273.15) * 9/5 + 32 } } };
        function populateUnits() { const type = converterType.value; const unitList = Object.keys(units[type]); converterFrom.innerHTML = ''; converterTo.innerHTML = ''; unitList.forEach(unit => { converterFrom.innerHTML += `<option value="${unit}">${unit}</option>`; converterTo.innerHTML += `<option value="${unit}">${unit}</option>`; }); converterFrom.value = unitList.includes('m') ? 'm' : unitList.includes('g') ? 'g' : unitList[0]; converterTo.value = unitList.includes('cm') ? 'cm' : unitList.includes('kg') ? 'kg' : unitList[1]; convert(); }
        function convert() { const type = converterType.value; const val = parseFloat(converterInput.value); if (isNaN(val)) { converterOutput.textContent = '-'; return; } const from = converterFrom.value; const to = converterTo.value; const toBase = units[type][from].toBase(val); const result = units[type][to].fromBase(toBase); converterOutput.textContent = `${Number(result.toPrecision(5))} ${to}`; }
        async function fetchElements() { if (elementsData.length > 0) return; try { const response = await fetch('https://raw.githubusercontent.com/Bowserinator/Periodic-Table-JSON/master/PeriodicTableJSON.json'); const data = await response.json(); elementsData = data.elements; generatePeriodicTable(); } catch (error) { console.error("Could not load periodic table data:", error); if(periodicTableContainer) periodicTableContainer.innerHTML = "Error loading data."; } }
        function generatePeriodicTable() { if (!periodicTableContainer) return; periodicTableContainer.innerHTML = ''; elementsData.forEach(el => { const cell = document.createElement('div'); cell.className = 'element-cell'; cell.style.gridColumn = el.xpos; cell.style.gridRow = el.ypos; cell.innerHTML = `<div class="atomic-number">${el.number}</div><div class="symbol">${el.symbol}</div><div class="name">${el.name}</div>`; cell.classList.add(`category-${el.category.replace(/ /g, '-')}`); cell.addEventListener('click', () => showElementDetails(el)); periodicTableContainer.appendChild(cell); }); }
        function showElementDetails(el) { if (!elementDetailsPanel) return; elementDetailsPanel.innerHTML = ` <div class="details-symbol">${el.symbol}</div> <div class="details-name">${el.name}</div> <div class="details-info"> <div class="details-info-item"><span class="value">${el.number}</span><span class="label">Numéro Atomique</span></div> <div class="details-info-item"><span class="value">${el.atomic_mass.toFixed(3)}</span><span class="label">Masse Atomique (u)</span></div> </div>`; elementDetailsPanel.style.display = 'block'; elementDetailsPanel.scrollIntoView({ behavior: 'smooth', block: 'center' }); }
        function initTools() { converterType = document.getElementById('converter-type'); converterInput = document.getElementById('converter-input'); converterFrom = document.getElementById('converter-from'); converterTo = document.getElementById('converter-to'); converterOutput = document.getElementById('converter-output'); periodicTableContainer = document.getElementById('periodic-table-container'); elementDetailsPanel = document.getElementById('element-details-panel'); if (!converterType) return; converterType.removeEventListener('change', populateUnits); converterInput.removeEventListener('input', convert); converterFrom.removeEventListener('change', convert); converterTo.removeEventListener('change', convert); converterType.addEventListener('change', populateUnits); converterInput.addEventListener('input', convert); converterFrom.addEventListener('change', convert); converterTo.addEventListener('change', convert); populateUnits(); fetchElements(); }

        // --- EVENT LISTENERS & FINAL SETUP ---
        document.addEventListener('DOMContentLoaded', () => {
            initTools(); 
            onAuthStateChanged(auth, (user) => {
                if (user) {
                    if (unsubscribeFromFirestore) unsubscribeFromFirestore();
                    const userDocRef = doc(db, "users", user.uid);
                    unsubscribeFromFirestore = onSnapshot(userDocRef, (docSnap) => {
                        if (docSnap.exists()) {
                            updateUIForUser(user, docSnap.data());
                        }
                    });
                } else {
                    updateUIForGuest();
                    if (unsubscribeFromFirestore) unsubscribeFromFirestore();
                }
            });

            focusToggle.addEventListener('click', () => {
                document.body.classList.toggle('focus-mode');
                const icon = focusToggle.querySelector('i');
                const text = focusToggle.querySelector('span');
                if (document.body.classList.contains('focus-mode')) {
                    icon.classList.replace('fa-eye', 'fa-eye-slash'); text.textContent = 'Normal';
                } else {
                    icon.classList.replace('fa-eye-slash', 'fa-eye'); text.textContent = 'Focus';
                }
            });
            
            signupForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const pseudo = document.getElementById('signup-pseudo').value;
                const email = document.getElementById('signup-email').value;
                const password = document.getElementById('signup-password').value;
                createUserWithEmailAndPassword(auth, email, password)
                    .then(userCredential => setDoc(doc(db, "users", userCredential.user.uid), { pseudo, email, progress: {} }))
                    .then(() => { showMessage('signup', 'Compte créé avec succès !', 'success'); signupForm.reset(); showPage('page-accueil'); })
                    .catch(error => showMessage('signup', `Erreur: ${error.message}`, 'error'));
            });

            loginForm.addEventListener('submit', (e) => {
                e.preventDefault();
                const email = document.getElementById('login-email').value;
                const password = document.getElementById('login-password').value;
                signInWithEmailAndPassword(auth, email, password)
                    .then(() => { loginForm.reset(); showPage('page-accueil'); })
                    .catch(error => showMessage('login', `Erreur: ${error.message}`, 'error'));
            });

            logoutLink.addEventListener('click', (e) => { e.preventDefault(); signOut(auth); });
            
            addResourceForm.addEventListener('submit', (e) => {
                e.preventDefault();
                
                const subject = document.getElementById('resource-subject').value;
                const title = document.getElementById('resource-title').value;
                const fileInput = document.getElementById('resource-file');
                const file = fileInput.files[0];

                if (!file) {
                    showMessage('admin', 'Veuillez sélectionner un fichier PDF.', 'error');
                    return;
                }

                const submitButton = addResourceForm.querySelector('button[type="submit"]');
                const progressContainer = document.getElementById('upload-progress-container');
                const progressBar = document.getElementById('upload-progress-bar');
                const progressText = document.getElementById('upload-progress-text');

                submitButton.disabled = true;
                submitButton.textContent = 'CHARGEMENT...';
                progressContainer.style.display = 'block';

                const storageRef = ref(storage, `resources/${subject}/${Date.now()}_${file.name}`);
                const uploadTask = uploadBytesResumable(storageRef, file);

                uploadTask.on('state_changed', 
                    (snapshot) => {
                        const progress = (snapshot.bytesTransferred / snapshot.totalBytes) * 100;
                        progressBar.style.width = progress + '%';
                        progressText.textContent = `Chargé à ${Math.round(progress)}%`;
                    }, 
                    (error) => {
                        console.error("Upload error: ", error);
                        let friendlyMessage = `Erreur d'upload: ${error.code}.`;
                        if (error.code === 'storage/unauthorized') {
                            friendlyMessage = "Erreur de permission. Vérifiez vos règles de sécurité Firebase Storage et la configuration CORS.";
                        } else if (error.code === 'storage/canceled') {
                            friendlyMessage = "Le chargement a été annulé.";
                        } else if (error.code === 'storage/object-not-found') {
                            friendlyMessage = "Erreur 404 : Objet non trouvé. Vérifiez la valeur de 'storageBucket' dans votre firebaseConfig.";
                        }
                        showMessage('admin', friendlyMessage, 'error');
                        
                        submitButton.disabled = false;
                        submitButton.textContent = 'Ajouter le cours';
                        progressContainer.style.display = 'none';
                    }, 
                    async () => {
                        try {
                            const downloadURL = await getDownloadURL(uploadTask.snapshot.ref);
                            
                            await addDoc(collection(db, "resources"), { 
                                subject, 
                                title, 
                                url: downloadURL,
                                createdAt: new Date()
                            });
                            
                            showMessage('admin', 'Ressource ajoutée avec succès!', 'success');
                            addResourceForm.reset();
                            loadCoursesForAdmin(); // Recharger la liste après ajout
                        } catch (error) {
                            console.error("Error adding document to Firestore: ", error);
                            showMessage('admin', `Erreur Firestore: ${error.message}`, 'error');
                        } finally {
                            submitButton.disabled = false;
                            submitButton.textContent = 'Ajouter le cours';
                            progressContainer.style.display = 'none';
                        }
                    }
                );
            });

        });
        
    </script>
</body>
</html>
